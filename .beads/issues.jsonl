{"id":"DIVE-031","title":"Remove API access and webhooks functionality","description":"Remove or deprecate API access and webhooks features from the platform:\n\nSCOPE ASSESSMENT:\n- Identify all existing API endpoints for external access\n- Identify all webhook implementations\n- Review current usage (if any)\n- Assess impact on existing integrations\n- Determine deprecation timeline\n\nAPI ACCESS REMOVAL:\n- Remove API key generation functionality\n- Remove API key authentication middleware\n- Remove API key management UI\n- Delete API key database tables\n- Remove API documentation pages\n- Remove API-specific routes and endpoints\n- Clean up API-related environment variables\n\nWEBHOOK REMOVAL:\n- Remove webhook subscription endpoints\n- Remove webhook delivery service\n- Remove webhook signature generation\n- Delete webhook subscriptions from database\n- Remove webhook configuration UI\n- Remove webhook event logging\n- Stop webhook retry jobs/workers\n\nDATABASE CLEANUP:\n- Drop api_keys table (if exists)\n- Drop webhook_subscriptions table (if exists)\n- Drop webhook_events table (if exists)\n- Drop webhook_delivery_log table (if exists)\n- Remove API-related columns from other tables\n- Clean up orphaned records\n\nAFFECTED INTEGRATIONS:\n- Review Zapier integration dependencies\n  * May need to keep minimal webhook support for Zapier\n  * Or migrate to different integration approach\n- Check QuickBooks integration\n- Check Google Calendar integration\n- Check Stripe webhook handling (keep - required for Stripe)\n- Identify any custom integrations using API\n\nCODE REMOVAL:\nFiles/modules to remove or update:\n- /lib/api/ directory (if exists)\n- /lib/webhooks/ directory (if exists)\n- /app/routes/api/ - external API routes\n- /app/routes/settings/api-keys.tsx (if exists)\n- /app/routes/settings/webhooks.tsx (if exists)\n- API authentication middleware\n- Webhook delivery service\n- API rate limiting logic\n- Webhook signature verification\n\nSETTINGS/UI CLEANUP:\n- Remove API Keys page from settings menu\n- Remove Webhooks page from settings menu\n- Remove API documentation links\n- Update settings navigation\n- Remove API-related form components\n- Remove webhook configuration forms\n\nJOBS/WORKERS:\n- Remove webhook delivery worker\n- Remove webhook retry job\n- Remove API usage tracking job\n- Clean up job queue configurations\n- Update worker processes\n\nSECURITY CLEANUP:\n- Remove API key hashing utilities\n- Remove webhook signature generation\n- Remove API-scoped permissions\n- Update security documentation\n- Remove API-related audit logs (or archive)\n\nENVIRONMENT VARIABLES:\nRemove or deprecate:\n- API_ENABLED\n- API_RATE_LIMIT_*\n- WEBHOOK_SIGNING_SECRET\n- API_VERSION\n- Update .env.example\n- Update deployment configurations\n\nMIGRATION PATH (if keeping some functionality):\n- If keeping Zapier webhooks:\n  * Separate Zapier-specific webhook implementation\n  * Use internal webhook system only\n  * Document Zapier as special case\n  \n- If keeping Stripe webhooks:\n  * Keep /api/webhooks/stripe endpoint\n  * Remove generic webhook framework\n  * Stripe webhooks are internal, not user-configurable\n\nDOCUMENTATION UPDATES:\n- Remove API documentation pages\n- Remove webhook setup guides\n- Update integration documentation\n- Add deprecation notice (if phased removal)\n- Update changelog\n- Update README\n\nTESTING:\n- Remove API endpoint tests\n- Remove webhook delivery tests\n- Remove API authentication tests\n- Update integration tests\n- Verify existing functionality still works\n- Test that removed endpoints return 404\n\nCOMMUNICATION (if users affected):\n- Deprecation announcement\n- Migration timeline\n- Alternative solutions\n- Support for affected users\n- Email notifications to API key holders\n\nALTERNATIVES TO CONSIDER:\nInstead of complete removal, consider:\n- Keep internal webhooks only (for system integrations)\n- Keep read-only API for specific use cases\n- Implement OAuth for future integrations\n- Use Zapier as the official integration method\n\nPHASED REMOVAL (if needed):\nPhase 1 (Week 1-2):\n- Mark features as deprecated\n- Add deprecation warnings to UI\n- Communicate to users\n- Provide migration guides\n\nPhase 2 (Week 3-4):\n- Disable new API key creation\n- Disable new webhook subscriptions\n- Existing keys/webhooks still work\n\nPhase 3 (Week 5-6):\n- Remove UI components\n- Archive existing API keys\n- Stop webhook deliveries\n\nPhase 4 (Week 7-8):\n- Remove backend code\n- Drop database tables\n- Final cleanup\n\nROLLBACK PLAN:\n- Database backup before table drops\n- Code branch before removal\n- Feature flag to re-enable if needed\n- Timeline for decision to rollback\n\nEXCEPTIONS TO KEEP:\n✓ Stripe webhooks - Required for payment processing\n  * Keep /api/webhooks/stripe\n  * Keep Stripe webhook verification\n  \n✓ Internal system webhooks (if used)\n  * Job completion notifications\n  * System event broadcasts\n  \n? Zapier webhooks - Decide based on Zapier integration plans\n  * If Zapier integration stays, keep minimal webhook support\n  * Or migrate to Zapier Platform REST Hooks\n\nFILES TO REVIEW:\n- lib/integrations/zapier.server.ts\n- app/routes/api/webhooks/\n- Database schema files\n- Authentication middleware\n- Integration documentation","status":"open","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:23:48.556039-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:23:48.556039-08:00"}
{"id":"DIVE-36c","title":"Fully implement Zapier integration for workflow automation","description":"Complete Zapier integration to enable no-code workflow automation and third-party app connections:\n\nZAPIER APP PLATFORM:\n- Build official DiveStreams Zapier app\n- Submit to Zapier App Directory\n- Public vs Private app versions\n- App branding and description\n- Category selection (Business Management, CRM)\n- Support and documentation links\n\nAUTHENTICATION:\n- Implement API Key authentication for Zapier\n- OAuth2 authentication option (future enhancement)\n- Secure key generation and management\n- Key rotation/revocation\n- Per-organization API keys\n- Scoped permissions (read vs write)\n- Test authentication endpoint\n\nTRIGGERS (Send data FROM DiveStreams TO other apps):\n- New Booking Created\n  * Trigger when customer books a trip\n  * Sample data: customer name, email, trip details, booking number\n  * Polling URL: GET /api/zapier/triggers/bookings/new\n  \n- Booking Status Changed\n  * Trigger on confirmed/cancelled/completed status\n  * Include previous and new status\n  * Polling URL: GET /api/zapier/triggers/bookings/status-changed\n  \n- New Customer Created\n  * Trigger when new customer registers\n  * Customer profile data\n  * Polling URL: GET /api/zapier/triggers/customers/new\n  \n- Payment Received\n  * Trigger on successful payment\n  * Payment amount, method, booking reference\n  * Polling URL: GET /api/zapier/triggers/payments/received\n  \n- Trip Fully Booked\n  * Trigger when trip reaches capacity\n  * Trip details and waitlist info\n  * Polling URL: GET /api/zapier/triggers/trips/fully-booked\n  \n- Review Submitted\n  * Trigger when customer submits review\n  * Review rating, text, customer info\n  * Polling URL: GET /api/zapier/triggers/reviews/new\n  \n- Equipment Rental\n  * Trigger on equipment rental\n  * Equipment details, rental period\n  * Polling URL: GET /api/zapier/triggers/equipment/rented\n\nACTIONS (Send data FROM other apps TO DiveStreams):\n- Create Booking\n  * Create new booking via Zapier\n  * Input: customer details, trip ID, participants\n  * Endpoint: POST /api/zapier/actions/bookings/create\n  \n- Update Booking Status\n  * Change booking status (confirm, cancel)\n  * Input: booking ID, new status, reason\n  * Endpoint: POST /api/zapier/actions/bookings/update-status\n  \n- Create Customer\n  * Add new customer to system\n  * Input: name, email, phone, emergency contact\n  * Endpoint: POST /api/zapier/actions/customers/create\n  \n- Add Customer Note\n  * Append note to customer profile\n  * Input: customer ID, note text, category\n  * Endpoint: POST /api/zapier/actions/customers/add-note\n  \n- Send Email via Template\n  * Trigger email to customer using template\n  * Input: customer email, template ID, variables\n  * Endpoint: POST /api/zapier/actions/emails/send\n  \n- Add to Waitlist\n  * Add customer to trip waitlist\n  * Input: customer ID, trip ID\n  * Endpoint: POST /api/zapier/actions/waitlist/add\n\nSEARCHES (Find existing data):\n- Find Booking\n  * Search by booking number, customer email, or trip\n  * Endpoint: GET /api/zapier/searches/bookings\n  \n- Find Customer\n  * Search by email, phone, or name\n  * Endpoint: GET /api/zapier/searches/customers\n  \n- Find Trip\n  * Search by name, date, or location\n  * Endpoint: GET /api/zapier/searches/trips\n\nPOLLING \u0026 WEBHOOKS:\n- REST Hooks (recommended by Zapier)\n- Implement subscribe/unsubscribe endpoints:\n  * POST /api/zapier/hooks/subscribe\n  * DELETE /api/zapier/hooks/unsubscribe/:id\n- Store webhook subscriptions in database\n- Trigger webhooks on relevant events\n- Dedupe key for preventing duplicates\n- Webhook retry logic (3 attempts, exponential backoff)\n\nAPI ENDPOINTS:\n- GET /api/zapier/auth/test - Test authentication\n- GET /api/zapier/triggers/:trigger_name - Polling triggers\n- POST /api/zapier/actions/:action_name - Execute actions\n- GET /api/zapier/searches/:search_name - Search queries\n- POST /api/zapier/hooks/subscribe - Subscribe to webhook\n- DELETE /api/zapier/hooks/unsubscribe/:id - Unsubscribe\n- GET /api/zapier/schema - Dynamic field schema\n\nDATABASE SCHEMA:\n- zapier_api_keys table:\n  * organization_id\n  * api_key (hashed)\n  * key_name\n  * scopes (JSON array)\n  * last_used_at\n  * expires_at\n  * created_by_user_id\n  * created_at\n  * revoked_at\n\n- zapier_webhook_subscriptions table:\n  * subscription_id\n  * organization_id\n  * trigger_name (booking.created, payment.received, etc)\n  * target_url (Zapier webhook URL)\n  * created_at\n  * last_triggered_at\n  * is_active\n\n- zapier_event_log table:\n  * event_id\n  * organization_id\n  * trigger_name\n  * webhook_url\n  * payload (JSON)\n  * status (success/failed)\n  * status_code\n  * error_message\n  * triggered_at\n  * retry_count\n\nZAPIER APP CONFIGURATION:\n- app.yaml / zapier.json definition\n- Trigger definitions with input/output schemas\n- Action definitions with input/output schemas\n- Search definitions\n- Dynamic dropdowns (trips, customers)\n- Field help text and placeholders\n- Sample data for testing\n- Error handling messages\n\nDYNAMIC DROPDOWNS:\n- List Trips (for booking actions)\n  * Endpoint: GET /api/zapier/dropdowns/trips\n  * Return: [{id, name, date}]\n  \n- List Customers (for note actions)\n  * Endpoint: GET /api/zapier/dropdowns/customers\n  * Return: [{id, name, email}]\n  \n- List Email Templates\n  * Endpoint: GET /api/zapier/dropdowns/email-templates\n  * Return: [{id, name, subject}]\n\nSAMPLE DATA:\n- Provide realistic sample data for each trigger/action\n- Used by Zapier for Zap setup preview\n- Should match actual API response format\n- Include all possible fields\n\nUI COMPONENTS:\n- Zapier integration page in settings\n- API key generation interface\n- Active Zap viewer (if using Zapier Platform UI)\n- Connected apps dashboard\n- Event log viewer\n- API usage statistics\n- Key management (create, revoke, rotate)\n- Documentation links\n\nPOPULAR ZAP TEMPLATES:\n- \"New Booking → Add to Google Sheets\"\n- \"New Booking → Send Slack notification\"\n- \"New Customer → Add to Mailchimp\"\n- \"Payment Received → Update QuickBooks\"\n- \"Booking Cancelled → Send cancellation email via Gmail\"\n- \"Trip Fully Booked → Create Google Calendar event\"\n- \"New Review → Post to company Slack channel\"\n\nERROR HANDLING:\n- Invalid API key (401 Unauthorized)\n- Missing required fields (400 Bad Request)\n- Resource not found (404 Not Found)\n- Rate limiting (429 Too Many Requests)\n- Server errors (500)\n- Helpful error messages for Zapier users\n- Retry-After headers for rate limits\n\nSECURITY:\n- API key hashing in database\n- Rate limiting per organization\n- Input validation and sanitization\n- SQL injection prevention\n- CSRF not needed (API-only)\n- Webhook signature verification (optional)\n- Scope-based permissions\n- Audit logging\n\nRATE LIMITING:\n- 100 requests per minute per API key\n- 5000 requests per day per organization\n- Return 429 with Retry-After header\n- Communicate limits in Zapier app docs\n\nTESTING:\n- Unit tests for all triggers/actions/searches\n- Integration tests with Zapier CLI\n- Test webhook subscriptions\n- Test dynamic dropdowns\n- Test deduplication\n- Test error scenarios\n- Load testing for popular triggers\n\nDOCUMENTATION:\n- Zapier app setup guide\n- Authentication instructions\n- Available triggers/actions/searches\n- Field descriptions and examples\n- Common Zap templates\n- Troubleshooting guide\n- API rate limits\n- Changelog for app updates\n- Environment variables:\n  * ZAPIER_API_ENABLED (true/false)\n  * ZAPIER_RATE_LIMIT_PER_MINUTE\n  * ZAPIER_RATE_LIMIT_PER_DAY\n\nMONITORING:\n- Track Zapier API usage per organization\n- Monitor webhook delivery success rate\n- Alert on high failure rates\n- Track most popular triggers/actions\n- Performance metrics (response times)\n\nZAPIER PLATFORM TOOLS:\n- Use Zapier Platform CLI for development\n- zapier test - Run tests\n- zapier validate - Validate app definition\n- zapier push - Deploy to Zapier\n- zapier promote - Promote to production\n- zapier logs - View production logs\n\nSUBMISSION \u0026 REVIEW:\n- Zapier app submission checklist\n- App review process preparation\n- Beta testing phase\n- Public launch preparation\n- Zapier brand guidelines compliance","status":"open","priority":2,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:22:42.712044-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:22:42.712044-08:00"}
{"id":"DIVE-3cm","title":"Fix E2E test authentication and timeout failures","description":"Fix 2 failing E2E tests: public-site.spec.ts (beforeAll timeout) and training-module.spec.ts (authentication failure). Root cause: dynamic Date.now() emails couldn't be shared between tests + global timeout override issue.","status":"closed","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-17T10:11:39.994704-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-17T10:11:58.008458-08:00","closed_at":"2026-01-17T10:11:58.008458-08:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"DIVE-3cm","author":"tom-gibson-med","text":"Completed E2E test fixes:\n1. Changed all test files to use fixed shared email 'e2e-user@example.com' instead of dynamic Date.now() emails\n2. Added test.setTimeout(60000) in public-site.spec.ts beforeAll hook to override global 30s timeout\n3. Files modified: full-workflow.spec.ts, public-site.spec.ts, training-module.spec.ts\n4. Committed in 14ff188 and pushed to staging\n5. CI/CD pipeline running with fixes","created_at":"2026-01-17T18:11:53Z"}]}
{"id":"DIVE-6j6","title":"Fix public site 404 errors and improve disabled site handling","description":"Fix various 404 errors and improve handling when public site is disabled or missing pages:\n\nIDENTIFIED ISSUES:\n\n1. MISSING ROUTES (404s):\n- /site/equipment - Navigation shows link but route doesn't exist\n- /site/gallery - Navigation shows link but route doesn't exist\n\n2. DISABLED SITE REDIRECT:\nFile: app/routes/site/_layout.tsx (line 197)\nCurrent behavior:\n- Redirects to /?site=disabled when public site is disabled\n- This likely 404s or shows wrong page\n\nSuggested fix:\n- Create dedicated /site-disabled page\n- Show branded \"Coming Soon\" message\n- Include organization name and contact info\n- Option to sign up for notifications when site launches\n\n3. NAVIGATION SHOWS DISABLED PAGES:\nThe layout navigation includes links to equipment and gallery even when:\n- The routes don't exist (always 404)\n- The pages are disabled in settings\n\nFix:\n- Navigation already checks enabledPages\n- But routes don't exist, so clicks result in 404\n- Need to implement missing routes OR hide from nav entirely\n\n4. MISSING ERROR BOUNDARY:\nNo custom 404 page for public site routes\n- Should show branded 404 with org theme\n- Suggest other pages to visit\n- Search functionality\n- Link back to home\n\nIMPLEMENTATION PLAN:\n\nPhase 1: Quick Fix (hide broken links)\n- Remove equipment and gallery from navigation until routes exist\n- OR disable these page toggles in settings until implemented\n\nPhase 2: Proper Disabled Site Handling\n- Create app/routes/site-disabled.tsx\n- Update redirect in _layout.tsx\n- Style with minimal branding\n- Show organization contact info if available\n\nPhase 3: 404 Error Boundary\n- Create app/routes/site/$.tsx (catch-all route)\n- Custom 404 page with site theme\n- Helpful navigation suggestions\n- Search functionality\n\nPhase 4: Implement Missing Pages\n- See DIVE-k2b for Equipment page\n- See DIVE-pif for Gallery page\n\nADDITIONAL IMPROVEMENTS:\n\nCheck Site Status Before Showing Forms:\n- Login/register pages should check if site is enabled\n- Redirect to main app if site is disabled\n\nSubdomain Resolution Errors:\n- Better error message when org not found\n- Suggest checking subdomain spelling\n- Link to DiveStreams main site\n\nSEO Considerations:\n- Proper 404 status codes\n- Meta robots noindex for disabled sites\n- Canonical URLs\n\nTESTING:\n- Test with site enabled and pages disabled\n- Test with site disabled\n- Test with invalid subdomain\n- Test with missing custom domain\n- Test navigation to non-existent pages","status":"closed","priority":1,"issue_type":"bug","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:50:56.883954-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:58:00.201924-08:00","closed_at":"2026-01-18T12:58:00.201924-08:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"DIVE-6j6","author":"tom-gibson-med","text":"✅ Completed all tasks for DIVE-6j6:\n\n1. Created /app/routes/site-disabled.tsx - Friendly disabled site message with organization name\n2. Updated /app/routes/site/_layout.tsx - Redirect to /site-disabled?org=\u003cname\u003e instead of /?site=disabled  \n3. Created /app/routes/site/$.tsx - Custom 404 page with site theme and helpful navigation\n4. Created /app/routes/site/equipment.tsx - Coming soon placeholder page with contact CTA\n5. Created /app/routes/site/gallery.tsx - Coming soon placeholder page with preview cards\n\nAll pages inherit the site theme, provide proper navigation, and handle edge cases gracefully.\n\nBuild successful, no type errors in new files.\nCommitted in 19890a6 and pushed to staging branch.","created_at":"2026-01-18T20:58:09Z"}]}
{"id":"DIVE-7xj","title":"Add staging deployment override for E2E failures and fix flaky tests","description":"1. Add CI/CD override to allow staging deployment despite E2E failures\n2. Fix flaky E2E tests with authentication state issues\n3. Deploy to staging and verify","status":"closed","priority":1,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T10:26:07.912986-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T11:03:19.18559-08:00","closed_at":"2026-01-18T11:03:19.18559-08:00","close_reason":"Closed","comments":[{"id":2,"issue_id":"DIVE-7xj","author":"tom-gibson-med","text":"✅ Successfully deployed to staging with E2E override enabled\n- Added continue-on-error to E2E job in deploy.yml\n- Fixed 4 flaky test assertions with proper auth checks\n- Deployment completed at 2026-01-18 19:01:06 UTC\n- Pipeline: https://github.com/shooter51/divestreams-v2/actions/runs/21116537768","created_at":"2026-01-18T19:01:06Z"}]}
{"id":"DIVE-89e","title":"Replace mock data in About page with real database content","description":"The public site About page currently uses mock/placeholder data for team members and certifications. Replace with real database-backed content:\n\nCURRENT ISSUES:\nFile: app/routes/site/about.tsx (lines 12-78)\n- Mock team members hardcoded in component\n- Mock certifications/affiliations hardcoded\n- No loader to fetch real data from database\n\nDATABASE SCHEMA NEEDED:\nteam_members table:\n- id, organization_id\n- name, role/title\n- profile_image_url\n- bio/description\n- certifications (JSON array or separate table)\n- sort_order\n- status (active/inactive)\n- created_at, updated_at\n\norganization_certifications table:\n- id, organization_id\n- certification_name\n- certifying_body (PADI, SSI, etc.)\n- logo_url\n- description\n- certification_number (if applicable)\n- valid_until (if expires)\n\nIMPLEMENTATION:\n1. Create database migrations for team_members and certifications\n2. Add loader to about.tsx to fetch real data\n3. Remove mock data constants\n4. Update component to render from loader data\n5. Add admin pages to manage team members and certifications\n6. Handle empty states (no team members yet)\n\nADMIN PANEL:\nCreate management pages:\n- /app/settings/team - Manage team members\n  * Add/edit/delete team members\n  * Upload profile photos\n  * Assign certifications\n  * Reorder team members\n\n- /app/settings/certifications - Manage certifications\n  * Add certifications/affiliations\n  * Upload certification logos\n  * Mark as featured for about page\n\nCONTENT SECTIONS:\nAbout page should support:\n- Rich text about content (already using aboutContent from settings)\n- Team member profiles (replace mock)\n- Organization certifications/affiliations (replace mock)\n- Timeline/history section (optional)\n- Values/mission statement (optional)\n\nFALLBACK BEHAVIOR:\n- If no team members: Show generic about content only\n- If no certifications: Hide certifications section\n- If no aboutContent: Show default welcome message","status":"open","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:50:14.40706-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:50:14.40706-08:00"}
{"id":"DIVE-8bl","title":"Add comprehensive training seed data for dive certifications","description":"Add comprehensive training seed data for dive certifications including agencies, levels, courses, and prerequisites:\n\nTRAINING AGENCIES:\n- PADI (Professional Association of Diving Instructors)\n- SSI (Scuba Schools International)  \n- NAUI (National Association of Underwater Instructors)\n- SDI/TDI (Scuba Diving International / Technical Diving International)\n- CMAS (World Underwater Federation)\n- BSAC (British Sub-Aqua Club)\n- GUE (Global Underwater Explorers)\n\nCERTIFICATION LEVELS:\nBeginner: Discover Scuba, Scuba Diver, Open Water Diver\nIntermediate: Advanced Open Water, Rescue Diver\nProfessional: Divemaster, Assistant Instructor, Instructor\nSpecialties: Deep, Wreck, Night, Nitrox, Navigation, etc.\nTechnical: Tec 40/45/50, Trimix\n\nSAMPLE COURSES:\n- Complete course records with pricing, duration, prerequisites\n- Course schedules (weekend/weekday options)\n- Equipment requirements\n- Training materials needed\n\nDATABASE SEEDS:\n- seeds/training-agencies.sql\n- seeds/certification-levels.sql\n- seeds/courses.sql\n- seeds/course-prerequisites.sql\n\nInclude realistic data with proper prerequisite chains, age requirements, depth limits, and certification numbers.","status":"open","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:25:19.064705-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:25:19.064705-08:00"}
{"id":"DIVE-8sh","title":"Fix public-site E2E test setup","description":"Public site E2E tests require publicSiteSettings.enabled = true but test setup doesn't configure this.\n\nRoot cause: The tenant public site layout checks settings.enabled and redirects to /?site=disabled if false.\n\nFix options:\n1. Add database seed/fixture to enable public site for e2etest tenant\n2. Add a setup step in public-site.spec.ts that enables public site via admin settings\n3. Modify the E2E database schema setup in CI to include public site enabled\n\nTests affected:\n- tests/e2e/workflow/public-site.spec.ts (44 tests currently skipped)","status":"closed","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-16T20:10:34.518146-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-16T22:17:29.19104-08:00","closed_at":"2026-01-16T22:17:29.19104-08:00","close_reason":"Closed"}
{"id":"DIVE-9ik","title":"Fix all URLs to respect base URL environment (staging vs production)","description":"Audit and fix all hardcoded URLs throughout the application to use environment-aware base URLs. DNS instructions, links, and all references should work correctly in staging and production.","status":"closed","priority":0,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T11:25:37.169361-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T11:39:24.236526-08:00","closed_at":"2026-01-18T11:39:24.236526-08:00","close_reason":"Fixed all hardcoded URLs to respect APP_URL environment variable. Updated 11 files across admin panel, tenant settings, email triggers, auth, integrations, and middleware. Fixed unit tests to expect environment-aware URLs. Deployed to staging via CI/CD pipeline #21117463232."}
{"id":"DIVE-b70","title":"Fix flaky public-site.spec.ts A.3 contact page test - beforeAll hook silently fails to enable public site, causing redirect to /?site=disabled","status":"open","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-17T10:47:38.910092-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-17T10:47:38.910092-08:00","labels":["bug","flaky","test"]}
{"id":"DIVE-bb2","title":"Configure APP_URL environment variable on staging VPS","description":"The staging VPS .env file is missing APP_URL=https://staging.divestreams.com, causing all URLs in the app to default to production domains. Need to SSH to VPS and update .env file.","status":"closed","priority":0,"issue_type":"bug","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:10:49.085603-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:12:38.463759-08:00","closed_at":"2026-01-18T12:12:38.463759-08:00","close_reason":"Added APP_URL=https://staging.divestreams.com to /docker/divestreams-staging/.env and restarted app container. DNS setup instructions and all URLs should now show staging.divestreams.com domains."}
{"id":"DIVE-bnl","title":"Implement contact form submission handling and storage","description":"The public site contact form has a TODO for storing messages and sending emails. Implement proper form submission handling:\n\nCURRENT ISSUE:\nFile: app/routes/site/contact.tsx\n- Form action has TODO comment\n- Messages are not stored in database\n- No email notifications sent\n- Form just returns success without actually processing\n\nREQUIRED FUNCTIONALITY:\nDatabase Storage:\n- Create contact_messages table:\n  * id, organization_id\n  * name, email, phone\n  * subject, message\n  * referrer_page\n  * user_agent\n  * ip_address (optional, for spam prevention)\n  * status (new/read/replied/archived)\n  * created_at\n  * replied_at, replied_by\n\nEmail Notifications:\n- Send email to organization contact email\n- Email subject: \"New Contact Form Submission - [subject]\"\n- Include all form fields\n- Reply-to: customer's email\n- CC/BCC options in settings\n\nAuto-Reply:\n- Optional auto-reply to customer\n- Confirm receipt of message\n- Set expectations for response time\n- Include organization contact info\n\nAdmin Integration:\n- Contact messages inbox in admin panel\n- Mark as read/unread\n- Reply functionality\n- Archive/delete\n- Spam filtering\n- Export to CSV\n\nForm Validation:\n- Required fields validation (already has client-side)\n- Email format validation\n- Phone format validation (optional)\n- Message length limits\n- Rate limiting (prevent spam)\n- Honeypot field (spam prevention)\n- reCAPTCHA integration (optional)\n\nSuccess Handling:\n- Clear form after submission\n- Success message display\n- Optional redirect to thank you page\n- Track conversion (analytics)\n\nError Handling:\n- Database errors\n- Email sending failures\n- Validation errors\n- Network timeouts\n- User-friendly error messages\n\nSettings Configuration:\nAdd to organization settings:\n- Contact form recipient email\n- Enable/disable auto-reply\n- Auto-reply template\n- Spam protection options\n- Require phone number (yes/no)\n\nIMPLEMENTATION:\n1. Create database migration for contact_messages\n2. Implement form action handler\n3. Add database insert\n4. Add email sending via job queue\n5. Add admin inbox page\n6. Add spam prevention\n7. Add tests\n\nRELATED:\n- Email job queue (lib/jobs/email.ts)\n- Spam prevention utilities\n- Admin notification system","status":"open","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:50:30.702292-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:50:30.702292-08:00"}
{"id":"DIVE-ci5","title":"Fully implement Stripe integration for payments and subscriptions","description":"Complete Stripe integration for the platform including:\n\nPAYMENT PROCESSING:\n- Customer creation and management in Stripe\n- Payment method storage and validation\n- One-time payment processing for bookings\n- Refund handling\n- Payment status webhooks\n\nSUBSCRIPTION MANAGEMENT:\n- Premium plan subscription setup\n- Subscription lifecycle (create, update, cancel)\n- Plan upgrades/downgrades\n- Proration handling\n- Trial periods\n- Subscription status webhooks\n\nWEBHOOKS:\n- Implement webhook endpoint at /api/webhooks/stripe\n- Handle all critical webhook events:\n  * payment_intent.succeeded\n  * payment_intent.failed\n  * customer.subscription.created\n  * customer.subscription.updated\n  * customer.subscription.deleted\n  * invoice.payment_succeeded\n  * invoice.payment_failed\n  * checkout.session.completed\n- Webhook signature verification\n- Idempotency handling\n\nSECURITY:\n- Secure API key storage (already using env vars)\n- Webhook signature verification\n- PCI compliance considerations\n- Error handling and logging\n\nUI COMPONENTS:\n- Payment method selection form\n- Card input (using Stripe Elements)\n- Subscription management page\n- Payment history\n- Invoice downloads\n\nTESTING:\n- Unit tests for Stripe service functions\n- Integration tests with Stripe test mode\n- Webhook event simulation tests\n- Error scenario testing\n\nDOCUMENTATION:\n- Setup instructions for Stripe account\n- Webhook configuration guide\n- Testing procedures\n- Environment variable documentation","status":"open","priority":2,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:20:21.611858-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:20:21.611858-08:00"}
{"id":"DIVE-j4x","title":"Fully implement QuickBooks integration for accounting and invoicing","description":"Complete QuickBooks Online integration for automated accounting, invoicing, and financial management:\n\nOAUTH \u0026 AUTHENTICATION:\n- Implement OAuth2 flow for QuickBooks Online API\n- Company authorization and consent\n- Token storage and refresh handling\n- Multi-tenant QuickBooks connections (per organization)\n- Company selection UI (multi-company support)\n- Disconnect/revoke access functionality\n- Sandbox vs Production environment support\n\nCUSTOMER SYNC:\n- Sync dive shop customers to QuickBooks as Customers\n- Two-way sync (QB → DiveStreams, DiveStreams → QB)\n- Customer creation with contact details\n- Customer updates (email, phone, address)\n- Customer deduplication and matching\n- Custom field mapping\n- Sync customer groups/categories\n\nINVOICE AUTOMATION:\n- Auto-create invoices in QuickBooks for bookings\n- Invoice line items (trip fees, equipment rentals, courses)\n- Tax calculation and application\n- Discount handling\n- Deposit invoices vs full invoices\n- Invoice status sync (draft, sent, paid, overdue)\n- Payment terms configuration\n- Custom invoice templates\n\nPAYMENT SYNC:\n- Record payments from bookings in QuickBooks\n- Payment method mapping (card, cash, check, bank transfer)\n- Payment application to invoices\n- Partial payment handling\n- Refund recording\n- Payment reconciliation\n- Bank deposit integration\n\nPRODUCT/SERVICE SYNC:\n- Sync dive trips as Services in QuickBooks\n- Equipment rentals as Products\n- Courses as Services\n- Price tier management\n- Tax codes and rates\n- Income account mapping\n- COGS tracking for equipment\n\nEXPENSE TRACKING:\n- Record trip expenses (boat fuel, guide wages, equipment maintenance)\n- Vendor management\n- Expense categorization\n- Receipt attachments\n- Billable vs non-billable expenses\n- Expense approval workflow\n\nSALES RECEIPTS:\n- Create sales receipts for paid-at-booking transactions\n- Immediate payment recording\n- POS integration for walk-in bookings\n- Receipt email automation\n\nFINANCIAL REPORTING:\n- Revenue by trip type/location\n- Customer payment history\n- Outstanding invoices report\n- Sales tax summary\n- Profit \u0026 loss by service category\n- Cash flow projections\n\nWEBHOOK \u0026 REAL-TIME SYNC:\n- Implement QuickBooks webhooks\n- Listen for customer/invoice/payment changes\n- Real-time sync triggers\n- Webhook verification and security\n- Event processing queue\n- Retry mechanism for failed syncs\n\nSYNC SETTINGS \u0026 PREFERENCES:\n- Enable/disable QuickBooks sync per organization\n- Choose what to sync (customers, invoices, payments, products)\n- Sync direction configuration\n- Account mapping (income, COGS, AR, sales tax)\n- Default payment terms\n- Invoice numbering format\n- Tax settings per location\n- Sync frequency (real-time, hourly, daily)\n\nAPI ENDPOINTS:\n- POST /api/integrations/quickbooks/connect - Start OAuth flow\n- POST /api/integrations/quickbooks/disconnect - Revoke access\n- GET /api/integrations/quickbooks/status - Check connection status\n- POST /api/integrations/quickbooks/sync - Manual sync trigger\n- POST /api/integrations/quickbooks/sync/customers - Sync customers only\n- POST /api/integrations/quickbooks/sync/invoices - Sync invoices only\n- POST /api/webhooks/quickbooks - Webhook receiver\n- GET /api/integrations/quickbooks/accounts - List QB chart of accounts\n- GET /api/integrations/quickbooks/settings - Get sync settings\n- PUT /api/integrations/quickbooks/settings - Update sync settings\n\nDATABASE SCHEMA:\n- quickbooks_connections table:\n  * organization_id\n  * realm_id (QuickBooks company ID)\n  * access_token (encrypted)\n  * refresh_token (encrypted)\n  * token_expires_at\n  * sync_enabled\n  * sync_settings (JSON)\n  * environment (sandbox/production)\n  * connected_at\n  * last_sync_at\n  * created_at, updated_at\n\n- quickbooks_sync_mappings table:\n  * organization_id\n  * entity_type (customer/product/service/invoice)\n  * local_id\n  * quickbooks_id\n  * last_synced_at\n  * sync_status\n\n- quickbooks_sync_log table:\n  * sync_id\n  * organization_id\n  * sync_type (customer/invoice/payment/product)\n  * entity_id\n  * quickbooks_entity_id\n  * direction (to_qb/from_qb)\n  * status (success/failed/pending)\n  * error_message\n  * request_payload\n  * response_payload\n  * synced_at\n\n- quickbooks_account_mappings table:\n  * organization_id\n  * mapping_type (income/cogs/sales_tax/ar)\n  * account_id (QuickBooks account ID)\n  * account_name\n\nUI COMPONENTS:\n- QuickBooks connection page in settings\n- OAuth consent flow UI\n- Company selection (for multi-company accounts)\n- Sync settings configuration form\n- Account mapping interface\n- Sync status dashboard\n- Manual sync buttons\n- Sync history/logs viewer\n- Error resolution UI\n- Financial reports viewer\n- Invoice preview before sync\n\nACCOUNTING FEATURES:\n- Chart of accounts mapping\n- Class/department tracking\n- Location tracking (for multi-location dive shops)\n- Sales tax handling by location\n- Multi-currency support\n- Fiscal year configuration\n- Journal entry creation\n\nERROR HANDLING:\n- Token expiration and refresh\n- API rate limiting (500 requests/min, 10k/day)\n- Network failures and retries\n- Duplicate detection\n- Validation errors\n- Permission errors\n- Graceful degradation\n- Sync conflict resolution\n- Orphaned record handling\n\nSECURITY:\n- Secure token storage (encryption at rest)\n- OAuth state parameter validation\n- CSRF protection\n- Webhook signature verification\n- Scope limitation (minimal permissions needed)\n- Audit logging for financial data access\n- PII protection compliance\n\nTESTING:\n- Unit tests for QuickBooks service functions\n- Integration tests with QB Sandbox\n- OAuth flow testing\n- Webhook event simulation\n- Sync scenarios (customer, invoice, payment)\n- Error handling tests\n- Idempotency tests\n- Rate limiting handling\n\nDOCUMENTATION:\n- QuickBooks developer account setup\n- OAuth app configuration\n- Sandbox testing guide\n- Production deployment checklist\n- Webhook configuration\n- Account mapping guide\n- Troubleshooting common issues\n- API quota management\n- Environment variables:\n  * QUICKBOOKS_CLIENT_ID\n  * QUICKBOOKS_CLIENT_SECRET\n  * QUICKBOOKS_REDIRECT_URI\n  * QUICKBOOKS_ENVIRONMENT (sandbox/production)\n  * QUICKBOOKS_WEBHOOK_VERIFIER_TOKEN\n\nCOMPLIANCE:\n- QuickBooks terms of service compliance\n- Data retention policies\n- Financial data backup\n- SOC 2 compliance considerations\n- GDPR/privacy law compliance for customer data","status":"open","priority":2,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:21:56.051929-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:21:56.051929-08:00"}
{"id":"DIVE-k2b","title":"Implement public site Equipment page and catalog","description":"Create the missing equipment page for the public site that displays available rental equipment and retail products:\n\nMISSING ROUTES:\n- app/routes/site/equipment/index.tsx (equipment catalog/listing)\n- app/routes/site/equipment/$equipmentId.tsx (individual equipment details)\n\nEQUIPMENT CATALOG PAGE (index.tsx):\nDisplay Features:\n- Grid/list view of available equipment\n- Equipment categories (BCDs, Regulators, Wetsuits, Computers, Fins, Masks, etc.)\n- Filter by category\n- Filter by size (if applicable)\n- Filter by rental vs purchase\n- Search functionality\n- Sorting (price, name, availability)\n- Pagination\n\nEquipment Card Display:\n- Equipment image\n- Name and brand\n- Category\n- Rental price per day\n- Purchase price (if available for sale)\n- Size options\n- Availability status\n- Quick view button\n- Add to booking button\n\nLoader Requirements:\n- Fetch equipment from database\n- Filter by organization\n- Join with categories\n- Join with images\n- Calculate availability\n- Support query params for filters/search\n\nEQUIPMENT DETAIL PAGE ($equipmentId.tsx):\nDisplay Features:\n- Large product image gallery\n- Equipment name and brand\n- Full description\n- Technical specifications\n- Size chart/guide\n- Rental pricing tiers (1 day, 3 days, week)\n- Purchase price (if for sale)\n- Availability calendar\n- Related equipment suggestions\n- Reviews/ratings (if available)\n- Add to booking button\n- Check availability form\n\nBooking Integration:\n- Add equipment to trip booking\n- Select rental dates\n- Calculate total rental cost\n- Quantity selection\n- Size selection\n\nDatabase Schema Requirements:\nCheck if equipment table exists with:\n- id, organization_id\n- name, brand, model\n- category_id\n- description, specifications\n- rental_price_per_day\n- purchase_price (nullable)\n- sizes (JSON array)\n- quantity_available\n- images (relation)\n- status (active/inactive)\n- requires_certification\n\nUI/UX Considerations:\n- Consistent with other public site pages\n- Mobile responsive\n- Theme integration (use site theme colors)\n- Loading states\n- Empty states (no equipment available)\n- Error handling (equipment not found)\n\nSEO:\n- Meta tags for equipment pages\n- Structured data for products\n- Image alt text\n- Descriptive URLs\n\nRelated Tasks:\n- Equipment management in admin panel (may already exist)\n- Equipment categories seeding\n- Sample equipment data\n- Image upload/management","status":"open","priority":1,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:49:16.72457-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:49:16.72457-08:00"}
{"id":"DIVE-k9t","title":"Deploy Tenant Public Site to Staging","description":"CI/CD pipeline running for staging deployment.\n\n## Changes\n- 42 files, 23,688 lines added\n- Public Site routes and components\n- Customer authentication system  \n- Theme system with 5 presets\n- Admin settings for public site\n- 91 new E2E tests (Training + Public Site)\n- Database migration for customer_credentials table\n\n## CI Run\nhttps://github.com/shooter51/divestreams-v2/actions/runs/21087544684\n\n## Status\n- [x] Lint passed\n- [x] Typecheck passed\n- [x] Unit/integration tests passed\n- [ ] E2E tests running","status":"closed","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-16T19:23:33.888443-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-16T20:29:03.942528-08:00","closed_at":"2026-01-16T20:29:03.942528-08:00","close_reason":"Closed","labels":["deployment"]}
{"id":"DIVE-lv8","title":"Partner with dive equipment manufacturers for catalog integration","description":"Establish partnerships with dive equipment manufacturers to integrate their product catalogs into the platform for equipment rental and sales:\n\nTARGET MANUFACTURERS:\nMajor Brands:\n- Aqua Lung / Apeks\n- Scubapro\n- Mares\n- Cressi\n- Oceanic\n- Suunto\n- Garmin (dive computers)\n- Shearwater (dive computers)\n- Hollis\n- Zeagle\n- Atomic Aquatics\n- Fourth Element (exposure protection)\n- DUI (drysuits)\n- Bare (exposure protection)\n- Aqualung\n- Sherwood\n\nPARTNERSHIP OBJECTIVES:\n- Access to official product catalogs\n- Product images and specifications\n- Real-time pricing updates\n- Inventory availability\n- Product discontinuation notices\n- New product launches\n- Marketing materials\n- Affiliate/dealer programs\n\nCATALOG DATA NEEDED:\nProduct Information:\n- SKU / Part Number\n- Product Name\n- Category (BCD, Regulator, Wetsuit, Computer, etc.)\n- Subcategory\n- Detailed description\n- Technical specifications\n- Size options\n- Color options\n- Weight\n- Dimensions\n- Materials\n- Certifications (CE, ISO)\n\nPricing:\n- MSRP (Manufacturer Suggested Retail Price)\n- Dealer/wholesale pricing\n- Volume discounts\n- Seasonal pricing\n- Currency options\n- Tax information\n\nMedia:\n- High-resolution product images (multiple angles)\n- Product videos\n- 360-degree views\n- Size charts\n- User manuals (PDFs)\n- Specification sheets\n- Marketing materials\n\nINTEGRATION METHODS:\nAPI Integration:\n- RESTful API access to catalog\n- Real-time inventory sync\n- Automated price updates\n- Product feed webhooks\n- OAuth authentication\n\nFile-Based:\n- CSV/Excel catalog exports\n- Scheduled updates (daily/weekly)\n- FTP/SFTP delivery\n- Email attachments\n\nManual:\n- Quarterly catalog PDFs\n- Dealer portals access\n- Price lists\n\nOUTREACH STRATEGY:\nInitial Contact:\n- Identify manufacturer dealer/partnership contacts\n- Prepare partnership proposal deck\n- Highlight platform benefits:\n  * Increased product visibility\n  * Direct sales channel to dive shops\n  * Marketing exposure\n  * Data insights on popular products\n  \nEmail Template:\nSubject: Partnership Opportunity - DiveStreams Equipment Catalog Integration\n\nBody:\nDear [Manufacturer] Partnership Team,\n\nWe are reaching out regarding a partnership opportunity for DiveStreams, a comprehensive dive shop management platform serving [X] dive centers worldwide.\n\nWe would like to integrate your product catalog to enable our dive shops to:\n- Offer your equipment for rental\n- Facilitate retail sales\n- Provide accurate product information to customers\n- Streamline equipment ordering\n\nBenefits for [Manufacturer]:\n- Increased brand visibility across our network\n- Direct sales channel to dive operators\n- Real-time product exposure\n- Marketing and promotional opportunities\n\nWe are interested in discussing:\n- Catalog data access (API or file-based)\n- Dealer pricing programs\n- Marketing collaboration\n- Technical integration support\n\nWould you be available for a brief call to explore this partnership?\n\nBest regards,\n[Your Name]\nDiveStreams Partnership Team\n\nFollow-up:\n- Schedule intro calls\n- Present platform demo\n- Discuss technical requirements\n- Negotiate terms\n- Execute partnership agreements\n\nPARTNERSHIP TIERS:\nPlatinum Partners:\n- Full API integration\n- Real-time sync\n- Featured placement\n- Co-marketing opportunities\n- Dedicated support\n\nGold Partners:\n- Weekly catalog updates\n- Priority listing\n- Marketing support\n- Standard support\n\nSilver Partners:\n- Monthly catalog updates\n- Standard listing\n- Basic support\n\nLEGAL CONSIDERATIONS:\nAgreements Needed:\n- Partnership/Dealer Agreement\n- Data Use Agreement\n- Trademark Usage Rights\n- Image Licensing\n- Pricing Confidentiality (dealer pricing)\n- Territory restrictions\n- Minimum order quantities\n- Return policies\n\nLiability:\n- Product information accuracy\n- Price accuracy disclaimers\n- Warranty handling\n- Customer support responsibilities\n\nTECHNICAL REQUIREMENTS:\nDatabase Schema:\n- equipment_manufacturers table\n- equipment_products table\n- equipment_categories table\n- equipment_pricing table\n- equipment_inventory table\n- manufacturer_api_credentials table\n\nAPI Integration:\n- Manufacturer API client implementation\n- Sync scheduling (cron jobs)\n- Error handling and retry logic\n- Data validation\n- Deduplication\n\nUI Components:\n- Equipment catalog browser\n- Product detail pages\n- Size/option selectors\n- Rental vs purchase toggle\n- Availability calendar\n- Price calculator\n\nBUSINESS MODEL:\nRevenue Options:\n- Referral commissions (%)\n- Affiliate program\n- Direct sales markup\n- Rental revenue share\n- Drop-shipping arrangements\n\nPricing Strategy:\n- Transparent pricing vs markup\n- Rental pricing tiers\n- Seasonal adjustments\n- Member discounts\n\nPILOT PROGRAM:\nPhase 1: Single Manufacturer Pilot\n- Choose 1-2 manufacturers for initial integration\n- Test technical integration\n- Validate business model\n- Gather feedback\n\nPhase 2: Expand to Top 5\n- Add major brands\n- Refine integration process\n- Improve UI based on feedback\n\nPhase 3: Full Rollout\n- Open to all manufacturers\n- Self-service onboarding\n- Automated catalog sync\n\nMETRICS TO TRACK:\nPartnership:\n- Number of manufacturers contacted\n- Response rate\n- Partnership conversion rate\n- Active partnerships\n\nTechnical:\n- Catalog sync success rate\n- Data accuracy\n- API uptime\n- Sync latency\n\nBusiness:\n- Products listed per manufacturer\n- Customer product views\n- Equipment rental bookings\n- Direct sales conversions\n- Revenue per manufacturer\n\nCOMPETITIVE ANALYSIS:\nResearch how competitors integrate:\n- ScubaBoard marketplace\n- LeisurePro\n- Dive Right In Scuba\n- Amazon dive equipment\n- Manufacturer direct sales\n\nTIMELINE:\nMonth 1-2: Research and Outreach\n- Identify target manufacturers\n- Prepare materials\n- Begin outreach\n\nMonth 3-4: Pilot Integration\n- Sign first partnership\n- Technical integration\n- Testing\n\nMonth 5-6: Expand\n- Add 3-5 more manufacturers\n- Refine processes\n\nMonth 7+: Ongoing\n- Continue adding partners\n- Optimize integrations\n- Monitor performance\n\nDELIVERABLES:\n- Partnership proposal deck\n- Outreach email templates\n- Partnership agreement templates\n- Technical integration documentation\n- API client implementations\n- Catalog sync system\n- Equipment catalog UI\n- Performance dashboard","status":"open","priority":3,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:25:59.016403-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:25:59.016403-08:00"}
{"id":"DIVE-pif","title":"Implement public site Gallery page for photos and media","description":"Create the missing gallery page for the public site to display photos, videos, and media:\n\nMISSING ROUTE:\n- app/routes/site/gallery.tsx (or gallery/index.tsx for future expansion)\n\nGALLERY PAGE FEATURES:\nDisplay Layout:\n- Responsive grid layout (masonry or standard grid)\n- Lightbox/modal for full-size viewing\n- Thumbnail previews\n- Image pagination or infinite scroll\n- Category/album filtering\n- Date filtering\n- Search by tags/keywords\n\nMedia Types:\n- Photos (primary)\n- Videos (YouTube/Vimeo embeds or direct uploads)\n- 360-degree photos (future enhancement)\n- Dive site galleries\n- Trip photo albums\n- Customer testimonial photos\n\nGallery Organization:\n- Albums/Collections:\n  * Recent Trips\n  * Dive Sites\n  * Marine Life\n  * Customer Adventures\n  * Behind the Scenes\n  * Instructor Team\n- Tags for filtering:\n  * Location tags\n  * Marine species tags\n  * Trip type tags\n  * Seasonal tags\n\nImage Display:\n- Thumbnail grid\n- Caption overlay on hover\n- Date taken\n- Location (if available)\n- Photographer credit\n- Download option (optional, configurable)\n- Share buttons (social media)\n\nLightbox Features:\n- Full-screen image viewing\n- Next/Previous navigation\n- Zoom capability\n- Touch gestures for mobile\n- Keyboard navigation (arrow keys, esc)\n- Image info panel (caption, date, location)\n- Close button\n\nDatabase Requirements:\nCreate or check gallery_images table:\n- id, organization_id\n- title, description\n- image_url, thumbnail_url\n- category/album\n- tags (JSON array)\n- date_taken\n- location\n- photographer\n- trip_id (optional relation)\n- dive_site_id (optional relation)\n- sort_order\n- is_featured\n- status (published/draft)\n- created_at, updated_at\n\ngallery_albums table:\n- id, organization_id\n- name, description\n- cover_image_url\n- sort_order\n- created_at\n\nLoader Requirements:\n- Fetch gallery images for organization\n- Filter by album/category\n- Support search/tags\n- Pagination\n- Order by featured, date, or custom sort\n- Include image dimensions for layout\n\nAdmin Integration:\n- Gallery management page in admin panel\n- Upload images (multiple at once)\n- Create/manage albums\n- Edit captions and metadata\n- Reorder images (drag-and-drop)\n- Bulk tag assignment\n- Featured image selection\n\nUI/UX:\n- Consistent with public site theme\n- Mobile responsive grid\n- Touch-friendly for mobile\n- Progressive image loading\n- Lazy loading for performance\n- Skeleton/placeholder while loading\n- Empty state (no images yet)\n\nSEO \u0026 Performance:\n- Image optimization (compression, lazy load)\n- Alt text for images\n- Meta tags for gallery page\n- Open Graph images for social sharing\n- Sitemap inclusion\n\nSample Albums/Categories:\n- \"Recent Adventures\" (latest trip photos)\n- \"Coral Reefs\" (underwater coral shots)\n- \"Marine Life\" (fish, turtles, sharks, etc.)\n- \"Wrecks \u0026 Caves\" (specialty diving)\n- \"Our Team\" (instructors and staff)\n- \"Happy Customers\" (customer photos)\n\nFuture Enhancements:\n- Customer photo uploads (after trip)\n- Photo contests\n- Instagram integration\n- Print/product ordering\n- Private galleries for customers","status":"open","priority":1,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:49:40.208749-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:49:40.208749-08:00"}
{"id":"DIVE-qxb","title":"Allow CI/CD to build even when E2E tests fail","description":"Modified workflow to build Docker image when unit tests pass but E2E tests fail. Also fixed flaky contact page E2E test assertion.","status":"closed","priority":2,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-17T10:20:41.613552-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-17T10:22:35.99004-08:00","closed_at":"2026-01-17T10:22:35.99004-08:00","close_reason":"Closed"}
{"id":"DIVE-wm8","title":"Implement Training Module Routes","description":"Training module routes are missing. E2E tests exist but routes were never created.\n\nRoutes needed:\n- /app/training (dashboard)\n- /app/training/courses (list, new, :id, :id/edit)\n- /app/training/sessions (list, new, :id)\n- /app/training/enrollments (list, :id)\n- /app/settings/training/agencies\n- /app/settings/training/levels\n\nServer functions needed (lib/db/training.server.ts):\n- getCourses, getCourse, createCourse, updateCourse, deleteCourse\n- getSessions, getSession, createSession, updateSession\n- getEnrollments, getEnrollment, createEnrollment, updateEnrollment\n- getAgencies, createAgency, getLevels, createLevel\n\nE2E tests already exist in tests/e2e/workflow/training-module.spec.ts (currently skipped)","status":"closed","priority":1,"issue_type":"task","owner":"tom.gibson@med-aware.com","created_at":"2026-01-16T19:52:04.318573-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-16T22:17:29.128058-08:00","closed_at":"2026-01-16T22:17:29.128058-08:00","close_reason":"Closed"}
{"id":"DIVE-wmt","title":"Add breadcrumbs and improve public site navigation UX","description":"Improve public site navigation with breadcrumbs, search, mobile menu, loading states, and better SEO. Includes breadcrumbs on all detail pages, global search functionality, hamburger menu for mobile, skeleton screens, floating action buttons, and accessibility improvements.","status":"open","priority":3,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:51:30.857029-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:51:30.857029-08:00"}
{"id":"DIVE-xgj","title":"Implement public site content editor and page builder","description":"Add rich content editing capabilities for public site pages beyond basic settings:\n\nCURRENT LIMITATIONS:\n- About page: Only basic aboutContent field (rich text)\n- No page builder or section editor\n- No image/media library management\n- No preview before publish\n- Limited customization per page\n\nCONTENT EDITOR FEATURES:\n\nRich Text Editor:\n- WYSIWYG editor (TipTap, Lexical, or similar)\n- Heading styles, lists, links\n- Image insertion from media library\n- Video embeds (YouTube, Vimeo)\n- Code blocks (for dive briefings, etc.)\n- Tables\n- Quotes/callouts\n- Save drafts\n\nPage Builder (Optional):\n- Drag-and-drop sections\n- Pre-built section templates:\n  * Hero banners\n  * Feature grids\n  * Testimonials\n  * Image galleries\n  * Call-to-action blocks\n  * FAQ accordions\n  * Pricing tables\n  * Contact forms\n- Section reordering\n- Section visibility toggles\n\nMedia Library:\n- Upload and organize images\n- Folder structure\n- Image editing (crop, resize, filters)\n- Alt text management\n- Bulk upload\n- Usage tracking (where image is used)\n- CDN integration\n\nContent Sections to Support:\n\nHome Page:\n- Hero section (image, title, subtitle, CTA)\n- Features/services grid\n- Upcoming trips showcase\n- Testimonials carousel\n- Instagram feed\n- Newsletter signup\n- Trust badges/certifications\n\nAbout Page:\n- Mission statement\n- History timeline\n- Team members section\n- Certifications/affiliations\n- Awards/recognition\n- Location/facilities\n\nCustom Pages:\n- FAQ page builder\n- Dive sites showcase\n- Accommodation info\n- Travel guides\n- Safety information\n- Marine life guides\n\nPreview \u0026 Publishing:\n- Live preview as you edit\n- Desktop/mobile preview toggle\n- Publish/unpublish toggle\n- Scheduled publishing\n- Draft/published status\n- Revision history\n- Rollback capability\n\nSEO Tools:\n- Per-page meta title\n- Meta description\n- Custom URL slugs\n- Social share images\n- Schema markup editor\n\nDatabase Schema:\npage_contents table:\n- id, organization_id\n- page_type (home, about, custom)\n- slug (for custom pages)\n- title\n- content (JSON - structured content)\n- meta_title, meta_description\n- og_image_url\n- status (draft, published)\n- published_at\n- created_by, updated_by\n- version\n- created_at, updated_at\n\nmedia_library table:\n- id, organization_id\n- filename, url\n- thumbnail_url\n- file_size, mime_type\n- width, height\n- alt_text, caption\n- folder_path\n- uploaded_by\n- created_at\n\nADMIN UI:\n- Content editor page per section\n- Media library browser\n- Page list with status\n- Duplicate page functionality\n- Import/export content\n\nTEMPLATES:\nProvide starter templates:\n- Classic dive shop\n- Modern boutique\n- Technical diving center\n- Resort/liveaboard\n- Training center\n- Equipment shop\n\nPERFORMANCE:\n- Content caching\n- Image optimization\n- Lazy loading\n- CDN delivery\n\nRELATED:\n- Public site theme system\n- Component library\n- Analytics integration\n- A/B testing (future)","status":"open","priority":2,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:51:57.185312-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:51:57.185312-08:00"}
{"id":"DIVE-zh3","title":"Fully implement Google Calendar integration for trip and booking sync","description":"Complete Google Calendar integration for syncing dive trips, bookings, and staff schedules:\n\nOAUTH \u0026 AUTHENTICATION:\n- Implement OAuth2 flow for Google Calendar API\n- User consent and authorization\n- Token storage and refresh handling\n- Multi-tenant calendar connections (per organization)\n- Calendar selection UI (primary vs other calendars)\n- Disconnect/revoke access functionality\n\nCALENDAR SYNC - TRIPS:\n- Sync dive trips to Google Calendar\n- Two-way sync (Google → DiveStreams, DiveStreams → Google)\n- Event creation with trip details (time, location, capacity, price)\n- Event updates when trip details change\n- Event deletion when trip is cancelled\n- Recurring trip handling\n- Color coding by trip type/status\n\nCALENDAR SYNC - BOOKINGS:\n- Create calendar events for confirmed bookings\n- Include customer details, participant count\n- Booking status updates (confirmed, cancelled, waitlist)\n- Attendee management\n- Reminders and notifications\n- Attach booking confirmation details\n\nCALENDAR SYNC - STAFF SCHEDULES:\n- Staff availability calendar integration\n- Guide assignments to trips\n- Shift scheduling\n- Conflict detection\n- Multi-calendar support for staff members\n\nWEBHOOK \u0026 PUSH NOTIFICATIONS:\n- Implement Google Calendar push notifications\n- Watch for external calendar changes\n- Handle event created/updated/deleted from Google\n- Sync conflicts resolution\n- Notification channel management\n- Channel renewal/expiration handling\n\nSYNC SETTINGS \u0026 PREFERENCES:\n- Enable/disable calendar sync per organization\n- Choose what to sync (trips, bookings, staff)\n- Sync direction (one-way vs two-way)\n- Event visibility settings (public/private)\n- Timezone handling\n- Custom event templates\n- Sync frequency configuration\n\nAPI ENDPOINTS:\n- POST /api/integrations/google-calendar/connect - Start OAuth flow\n- POST /api/integrations/google-calendar/disconnect - Revoke access\n- GET /api/integrations/google-calendar/status - Check connection status\n- POST /api/integrations/google-calendar/sync - Manual sync trigger\n- POST /api/webhooks/google-calendar - Webhook receiver for push notifications\n- GET /api/integrations/google-calendar/calendars - List available calendars\n\nDATABASE SCHEMA:\n- google_calendar_connections table:\n  * organization_id\n  * user_id\n  * access_token (encrypted)\n  * refresh_token (encrypted)\n  * calendar_id\n  * sync_enabled\n  * sync_settings (JSON)\n  * watch_channel_id\n  * watch_expiration\n  * created_at, updated_at\n\n- calendar_sync_log table:\n  * sync_id\n  * organization_id\n  * sync_type (trip/booking/staff)\n  * entity_id (trip_id/booking_id)\n  * google_event_id\n  * sync_direction (to_google/from_google)\n  * status (success/failed)\n  * error_message\n  * synced_at\n\nUI COMPONENTS:\n- Calendar connection page in settings\n- OAuth consent flow UI\n- Calendar selection dropdown\n- Sync settings configuration form\n- Sync status indicators\n- Manual sync button\n- Sync history/logs viewer\n- Conflict resolution UI\n- Calendar preview/embed\n\nERROR HANDLING:\n- Token expiration and refresh\n- API rate limiting (quota exceeded)\n- Network failures and retries\n- Sync conflict resolution\n- Invalid calendar permissions\n- Deleted external events\n- Graceful degradation when API is down\n\nSECURITY:\n- Secure token storage (encryption at rest)\n- OAuth state parameter validation\n- CSRF protection\n- Webhook signature verification\n- Scope limitation (minimal permissions)\n- Audit logging for calendar access\n\nTESTING:\n- Unit tests for calendar service functions\n- Integration tests with Google Calendar API (test mode)\n- OAuth flow testing\n- Webhook event simulation\n- Sync conflict scenarios\n- Rate limiting handling\n- Token refresh testing\n\nDOCUMENTATION:\n- Google Cloud Console setup guide\n- OAuth credentials configuration\n- Webhook setup instructions\n- Sync behavior documentation\n- Troubleshooting guide\n- API quota management\n- Environment variables needed:\n  * GOOGLE_CALENDAR_CLIENT_ID\n  * GOOGLE_CALENDAR_CLIENT_SECRET\n  * GOOGLE_CALENDAR_REDIRECT_URI","status":"open","priority":2,"issue_type":"feature","owner":"tom.gibson@med-aware.com","created_at":"2026-01-18T12:21:20.274602-08:00","created_by":"tom-gibson-med","updated_at":"2026-01-18T12:21:20.274602-08:00"}
